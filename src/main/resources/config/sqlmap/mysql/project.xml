<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.lac.repository.mapper.ProjectMapper">
	<resultMap id="projectMap" type="project">
		<result column="project_no" property="projectNo"></result>
		<result column="created_user_no" property="createdUserNo"></result>
		<result column="maseter_user_no" property="maseterUserNo"></result>
		<result column="project_info" property="projectInfo"></result>
		<result column="project_name" property="projectName"></result>
		<result column="project_pic" property="projectPic"></result>
		<result column="maseter_user_nickname" property="maseterUserNickname"></result>
		<result column="user_count" property="userCount"></result>
	</resultMap>

	<insert id="insertProject" parameterType="project">
		<selectKey keyProperty="projectNo" resultType="int" order="BEFORE">
			select MAX(project_no)+1 from tb_project
		</selectKey>
		insert into tb_project(
		created_user_no,
		maseter_user_no,
		project_name
		)values(
		#{userNo},
		#{userNo},
		#{projectName}
		)
	</insert>
	<insert id="insertProjectParticipant" parameterType="project">
		insert into tb_project_participant(
		project_no,
		user_no
		)values(
		#{projectNo},
		#{userNo}
		)
	</insert>
	<select id="selectProjectList" parameterType="int" resultMap="projectMap">
		select p.*, u.nickname as maseter_user_nickname, count(pp.user_no) as user_count
		  from tb_project as p
		 inner join tb_user as u
		    on p.maseter_user_no = u.user_no
		 inner join tb_project_participant as pp
		    on p.project_no = pp.project_no
		 where p.project_no in (select project_no
								from tb_project_participant
							   where user_no = #{userNo})
		 group by p.project_no
	</select>

</mapper>